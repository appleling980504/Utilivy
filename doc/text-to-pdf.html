<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Text to PDF / 文本转 PDF</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@3.4.1/dist/tailwind.min.css" rel="stylesheet">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC&display=swap');
    #editor {
      font-family: 'Noto Sans SC', sans-serif;
      white-space: pre-wrap;
      word-wrap: break-word;
    }
  </style>
</head>
<body class="bg-gray-100 text-gray-900 p-4">
  <div class="max-w-4xl mx-auto bg-white p-6 rounded shadow">
    <div class="flex justify-between items-center mb-4">
      <h1 class="text-xl font-bold">Text to PDF / 文本转 PDF</h1>
      <input type="text" id="filename" placeholder="Filename" class="text-sm border rounded px-2 py-1" />
    </div>

    <div class="flex flex-wrap gap-2 mb-4 text-sm">
      <select id="fontSize" class="border rounded px-2 py-1">
        <option value="12">Small</option>
        <option value="16" selected>Default</option>
        <option value="20">Large</option>
        <option value="24">Extra Large</option>
      </select>
      <select id="lineHeight" class="border rounded px-2 py-1">
        <option value="1">1.0</option>
        <option value="1.5" selected>1.5</option>
        <option value="2">2.0</option>
      </select>
      <select id="textAlign" class="border rounded px-2 py-1">
        <option value="left">Left</option>
        <option value="center">Center</option>
        <option value="right">Right</option>
        <option value="justify">Justify</option>
      </select>
      <input type="file" accept="image/*" id="imageInput" class="text-sm" />
    </div>

    <div class="flex gap-2 mb-4">
      <button onclick="formatText('bold')" class="bg-gray-200 px-2 py-1 rounded">Bold</button>
      <button onclick="formatText('underline')" class="bg-gray-200 px-2 py-1 rounded">Underline</button>
    </div>

    <div id="editor" contenteditable="true" class="w-full min-h-[300px] p-3 border rounded text-sm mb-4 bg-gray-50"></div>

    <button class="bg-blue-500 hover:bg-blue-600 text-white text-sm px-4 py-2 rounded" onclick="downloadPDF()">
      Generate PDF / 生成 PDF
    </button>
  </div>

  <script>
    const { jsPDF } = window.jspdf;

    function formatText(command) {
      document.execCommand(command);
    }

    document.getElementById('fontSize').addEventListener('change', function () {
      document.getElementById('editor').style.fontSize = this.value + 'px';
    });

    document.getElementById('lineHeight').addEventListener('change', function () {
      document.getElementById('editor').style.lineHeight = this.value;
    });

    document.getElementById('textAlign').addEventListener('change', function () {
      document.getElementById('editor').style.textAlign = this.value;
    });

    document.getElementById('imageInput').addEventListener('change', function () {
      const file = this.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = function (e) {
        const img = document.createElement('img');
        img.src = e.target.result;
        img.style.maxWidth = '100%';
        document.getElementById('editor').appendChild(img);
      };
      reader.readAsDataURL(file);
    });

    async function downloadPDF() {
      const content = document.getElementById('editor');
      const canvas = await html2canvas(content, { scale: 2, useCORS: true });
      const imgData = canvas.toDataURL('image/png');

      const pdf = new jsPDF({ unit: 'pt', format: 'a4', orientation: 'portrait' });
      const pageWidth = pdf.internal.pageSize.getWidth();
      const imgProps = pdf.getImageProperties(imgData);
      const imgHeight = (imgProps.height * pageWidth) / imgProps.width;

      pdf.addImage(imgData, 'PNG', 20, 20, pageWidth - 40, imgHeight);
      const fileName = document.getElementById('filename').value.trim() || 'converted.pdf';
      pdf.save(fileName);
    }
  </script>
</body>
</html>
