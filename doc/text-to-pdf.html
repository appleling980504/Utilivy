<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>文本转 PDF</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@3.4.1/dist/tailwind.min.css" rel="stylesheet">
  <style>
    body {
      font-family: sans-serif;
    }
    textarea {
      font-family: sans-serif;
    }
  </style>
</head>
<body class="bg-gray-100 text-gray-900 p-4">
  <div class="max-w-4xl mx-auto bg-white p-6 rounded shadow">
    <h1 class="text-xl font-bold mb-4">文本转 PDF（支持中文）</h1>

    <textarea id="textInput" rows="10" class="w-full p-3 border rounded text-sm mb-4" placeholder="输入中文或英文内容..."></textarea>

    <button onclick="downloadPDF()" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">生成 PDF</button>
  </div>

  <script>
    const { jsPDF } = window.jspdf;

    async function loadFont() {
      const fontUrl = './NotoSansCJKsc-Regular.otf'; // 确保这个文件和 HTML 同目录
      const fontData = await fetch(fontUrl).then(res => res.arrayBuffer());
      return fontData;
    }

    async function downloadPDF() {
      const text = document.getElementById('textInput').value;
      if (!text.trim()) {
        alert('请输入内容');
        return;
      }

      const pdf = new jsPDF({ unit: "pt", format: "a4" });
      const fontData = await loadFont();

      pdf.addFileToVFS("NotoSansCJKsc-Regular.otf", btoa(String.fromCharCode(...new Uint8Array(fontData))));
      pdf.addFont("NotoSansCJKsc-Regular.otf", "NotoSansCJK", "normal");
      pdf.setFont("NotoSansCJK");

      pdf.setFontSize(14);
      const lineHeight = 20;
      const margin = 40;
      let x = margin, y = margin + 10;

      const lines = pdf.splitTextToSize(text, 520);
      lines.forEach(line => {
        if (y > 800) {
          pdf.addPage();
          y = margin;
        }
        pdf.text(line, x, y);
        y += lineHeight;
      });

      pdf.save("text.pdf");
    }
  </script>
</body>
</html>
