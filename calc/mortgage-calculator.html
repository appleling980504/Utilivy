<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Mortgage Calculator - Toolnest</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: sans-serif;
      max-width: 700px;
      margin: 40px auto;
      padding: 20px;
      background-color: #f9fafb;
      color: #111;
    }
    h1 {
      text-align: center;
    }
    label {
      display: block;
      margin-top: 16px;
    }
    input, select {
      width: 100%;
      padding: 10px;
      margin-top: 6px;
      font-size: 16px;
    }
    button {
      margin-top: 20px;
      padding: 12px;
      background-color: #4f46e5;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
    .lang-switch {
      text-align: right;
      margin-bottom: 10px;
    }
    .result {
      margin-top: 24px;
      background: #eef2ff;
      padding: 16px;
      border-radius: 6px;
    }
  </style>
</head>
<body>
  <div class="lang-switch">
    <button onclick="toggleLang()" id="langBtn">中文</button>
  </div>

  <h1 id="title">Mortgage Calculator</h1>

  <label id="label-currency">Currency</label>
  <select id="currency">
    <option value="USD">$ USD</option>
    <option value="MYR">RM MYR</option>
    <option value="CNY">¥ CNY</option>
    <option value="EUR">€ EUR</option>
    <option value="JPY">¥ JPY</option>
  </select>

  <label id="label-home-price">Home Price</label>
  <input type="number" id="homePrice" placeholder="e.g. 500000" />

  <label id="label-down-payment">Down Payment</label>
  <input type="number" id="downPayment" placeholder="e.g. 50000" />

  <label id="label-loan-amount">Loan Amount</label>
  <input type="number" id="loanAmount" disabled />

  <label id="label-rate">Annual Interest Rate (%)</label>
  <input type="number" id="rate" placeholder="e.g. 4.5" step="0.01" />

  <label id="label-years">Loan Term (Years)</label>
  <input type="number" id="years" placeholder="e.g. 30" />

  <button onclick="calculate()" id="calc-btn">Calculate</button>

  <div class="result" id="result" style="display:none;"></div>
  <canvas id="chart" height="300"></canvas>

  <script>
    const labels = {
      en: {
        title: "Mortgage Calculator",
        currency: "Currency",
        homePrice: "Home Price",
        downPayment: "Down Payment",
        loanAmount: "Loan Amount",
        rate: "Annual Interest Rate (%)",
        years: "Loan Term (Years)",
        calc: "Calculate",
        monthly: "Monthly Payment",
        total: "Total Repayment",
        interest: "Total Interest"
      },
      zh: {
        title: "房贷计算器",
        currency: "货币",
        homePrice: "房屋总价",
        downPayment: "首付金额",
        loanAmount: "贷款金额",
        rate: "年利率 (%)",
        years: "贷款年限",
        calc: "计算",
        monthly: "每月还款额",
        total: "总还款金额",
        interest: "总利息"
      }
    };

    let lang = "en";
    let chart;

    function toggleLang() {
      lang = lang === "en" ? "zh" : "en";
      const l = labels[lang];
      document.getElementById("title").innerText = l.title;
      document.getElementById("label-currency").innerText = l.currency;
      document.getElementById("label-home-price").innerText = l.homePrice;
      document.getElementById("label-down-payment").innerText = l.downPayment;
      document.getElementById("label-loan-amount").innerText = l.loanAmount;
      document.getElementById("label-rate").innerText = l.rate;
      document.getElementById("label-years").innerText = l.years;
      document.getElementById("calc-btn").innerText = l.calc;
      document.getElementById("langBtn").innerText = lang === "en" ? "中文" : "English";
    }

    function formatMoney(n, code) {
      const sym = {
        USD: "$",
        MYR: "RM",
        CNY: "¥",
        EUR: "€",
        JPY: "¥"
      }[code] || "$";
      return sym + n.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    }

    document.getElementById("homePrice").addEventListener("input", updateLoanAmount);
    document.getElementById("downPayment").addEventListener("input", updateLoanAmount);

    function updateLoanAmount() {
      const price = parseFloat(document.getElementById("homePrice").value) || 0;
      const down = parseFloat(document.getElementById("downPayment").value) || 0;
      const loan = Math.max(price - down, 0);
      document.getElementById("loanAmount").value = loan;
    }

    function calculate() {
      const amount = parseFloat(document.getElementById("loanAmount").value);
      const rate = parseFloat(document.getElementById("rate").value) / 100;
      const years = parseInt(document.getElementById("years").value);
      const currency = document.getElementById("currency").value;
      const l = labels[lang];

      if (isNaN(amount) || isNaN(rate) || isNaN(years)) {
        alert("Please fill in all fields.");
        return;
      }

      const n = years * 12;
      const r = rate / 12;
      const monthly = amount * r / (1 - Math.pow(1 + r, -n));
      const total = monthly * n;
      const interest = total - amount;

      document.getElementById("result").style.display = "block";
      document.getElementById("result").innerHTML = `
        <strong>${l.monthly}:</strong> ${formatMoney(monthly, currency)}<br>
        <strong>${l.total}:</strong> ${formatMoney(total, currency)}<br>
        <strong>${l.interest}:</strong> ${formatMoney(interest, currency)}
      `;

      const payments = Array.from({ length: n }, () => monthly);
      const ctx = document.getElementById("chart").getContext("2d");
      if (chart) chart.destroy();
      chart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: payments.map((_, i) => `M${i + 1}`),
          datasets: [{
            label: l.monthly,
            data: payments,
            borderColor: "#4f46e5",
            backgroundColor: "rgba(79,70,229,0.2)",
            fill: true,
            tension: 0.3
          }]
        },
        options: {
          scales: {
            y: {
              beginAtZero: false
            }
          }
        }
      });
    }
  </script>
</body>
</html>
