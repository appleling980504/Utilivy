<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Mortgage Calculator - ToolNest</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: sans-serif; background: #f9f9f9; padding: 2rem; color: #333; }
    .container { max-width: 800px; margin: auto; background: white; padding: 2rem; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    input, select { padding: 0.5rem; margin: 0.5rem 0; width: 100%; box-sizing: border-box; }
    table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
    th, td { border: 1px solid #ccc; padding: 0.5rem; text-align: right; }
    th { background: #f0f0f0; }
    canvas { margin-top: 2rem; }
  </style>
</head>
<body>
<div class="container">
  <h2>ğŸ  Mortgage Calculator</h2>

  <label>Loan Amount:</label>
  <input type="number" id="loan" value="500000">

  <label>Annual Interest Rate (%):</label>
  <input type="number" id="rate" value="4">

  <label>Loan Term (Years):</label>
  <input type="number" id="years" value="30">

  <label>Monthly Extra Payment (optional):</label>
  <input type="number" id="extra" value="0">

  <label>MRTA / MLTA Cost (optional):</label>
  <input type="number" id="insurance" value="0">

  <label>Compare with Alternative Interest Rate (%):</label>
  <input type="number" id="altRate" value="3.5">

  <label>Graph Type:</label>
  <select id="chartType">
    <option value="line">ğŸ“ˆ Line Chart</option>
    <option value="bar">ğŸ“Š Bar Chart</option>
  </select>

  <button onclick="calculate()">Calculate</button>

  <div id="summary"></div>
  <canvas id="chart" height="120"></canvas>
  <table id="scheduleTable"></table>
</div>

<script>
  function formatCurrency(num) {
    return "$" + Number(num).toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 });
  }

  function calculate() {
    const loan = parseFloat(document.getElementById('loan').value);
    const rate = parseFloat(document.getElementById('rate').value) / 100 / 12;
    const years = parseInt(document.getElementById('years').value);
    const extra = parseFloat(document.getElementById('extra').value || 0);
    const insurance = parseFloat(document.getElementById('insurance').value || 0);
    const altRate = parseFloat(document.getElementById('altRate').value) / 100 / 12;
    const months = years * 12;

    let balance = loan;
    const monthly = loan * rate / (1 - Math.pow(1 + rate, -months));
    const altMonthly = loan * altRate / (1 - Math.pow(1 + altRate, -months));

    let totalInterest = 0, schedule = [], month = 1;
    while (balance > 0 && month <= months) {
      const interest = balance * rate;
      let principal = monthly - interest + extra;
      if (principal > balance) principal = balance;
      schedule.push({ month, principal, interest, payment: principal + interest });
      totalInterest += interest;
      balance -= principal;
      month++;
    }

    const totalPaid = schedule.reduce((sum, p) => sum + p.payment, 0) + insurance;
    const altTotal = altMonthly * months + insurance;
    const interestSaved = altTotal - totalPaid;

    document.getElementById('summary').innerHTML = `
      <p>ğŸ§¾ Monthly Payment: <strong>${formatCurrency(monthly)}</strong> (without extra)</p>
      <p>ğŸ“… Total Months: <strong>${schedule.length}</strong></p>
      <p>ğŸ’° Total Interest Paid: <strong>${formatCurrency(totalInterest)}</strong></p>
      <p>ğŸ Total Paid with Insurance: <strong>${formatCurrency(totalPaid)}</strong></p>
      <p>ğŸ’¡ Compared to ${document.getElementById('altRate').value}%: Saved <strong>${formatCurrency(interestSaved)}</strong></p>
    `;

    drawChart(schedule, document.getElementById('chartType').value);
    renderTable(schedule);
  }

  function drawChart(schedule, type = "line") {
    const months = schedule.map(p => p.month);
    const principal = schedule.map(p => p.principal);
    const interest = schedule.map(p => p.interest);

    if (window.chartInstance) window.chartInstance.destroy();
    window.chartInstance = new Chart(document.getElementById('chart'), {
      type,
      data: {
        labels: months,
        datasets: [
          { label: 'Principal', data: principal, backgroundColor: 'green', borderColor: 'green', fill: false },
          { label: 'Interest', data: interest, backgroundColor: 'red', borderColor: 'red', fill: false }
        ]
      },
      options: {
        responsive: true,
        scales: { y: { beginAtZero: true } },
        plugins: { legend: { position: 'top' }, title: { display: true, text: 'Monthly Breakdown' } }
      }
    });
  }

  function renderTable(schedule) {
    let html = `
      <thead><tr><th>Month</th><th>Principal</th><th>Interest</th><th>Total Payment</th></tr></thead>
      <tbody>
    `;
    schedule.forEach(p => {
      html += `<tr>
        <td>${p.month}</td>
        <td>${formatCurrency(p.principal)}</td>
        <td>${formatCurrency(p.interest)}</td>
        <td>${formatCurrency(p.payment)}</td>
      </tr>`;
    });
    html += '</tbody>';
    document.getElementById('scheduleTable').innerHTML = html;
  }

  // Initial calculate
  window.onload = () => calculate();
</script>
</body>
</html>
