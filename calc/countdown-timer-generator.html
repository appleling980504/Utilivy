<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Countdown</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@3.4.1/dist/tailwind.min.css" rel="stylesheet">
  <script>
    function getQueryParams() {
      const params = new URLSearchParams(window.location.search);
      const names = params.getAll('name').map(n => decodeURIComponent(n));
      const targets = params.getAll('target').map(t => decodeURIComponent(t));
      const lang = params.get('lang') || 'en';
      const color = decodeURIComponent(params.get('color') || '%2300d1b2');
      const bg = decodeURIComponent(params.get('bg') || '%23111111');
      const text = decodeURIComponent(params.get('text') || '%23ffffff');
      const size = params.get('size') || '28px';
      const titleSize = params.get('titleSize') || '22px';
      return { names, targets, lang, color, bg, text, size, titleSize };
    }

    function formatTimeDiff(diff, lang) {
      const totalSeconds = Math.floor(diff / 1000);
      if (totalSeconds < 0) return lang === 'zh' ? '已结束' : 'Ended';
      const days = Math.floor(totalSeconds / 86400);
      const hours = Math.floor((totalSeconds % 86400) / 3600);
      const minutes = Math.floor((totalSeconds % 3600) / 60);
      const seconds = totalSeconds % 60;

      if (lang === 'zh') {
        return `${days}天 ${hours}小时 ${minutes}分 ${seconds}秒`;
      } else {
        return `${days}d ${hours}h ${minutes}m ${seconds}s`;
      }
    }

    function startCountdown(names, targets, lang, color, bg, text, size, titleSize) {
      const container = document.getElementById('countdowns');
      container.innerHTML = '';

      const entries = names.map((name, idx) => ({
        name,
        target: new Date(targets[idx]),
      }));

      entries.sort((a, b) => a.target - b.target);

      entries.forEach((entry, index) => {
        const block = document.createElement('div');
        block.className = `p-4 rounded mb-4 text-center`;
        block.style.backgroundColor = bg;
        block.style.color = text;

        const title = document.createElement('h2');
        title.textContent = entry.name;
        title.style.fontSize = titleSize;
        title.style.color = color;
        title.className = 'font-bold mb-2';

        const time = document.createElement('div');
        time.className = 'font-mono';
        time.style.fontSize = size;
        time.id = `timer-${index}`;

        block.appendChild(title);
        block.appendChild(time);
        container.appendChild(block);

        const update = () => {
          const now = new Date();
          const diff = entry.target - now;
          time.textContent = formatTimeDiff(diff, lang);
        };

        update();
        setInterval(update, 1000);
      });
    }

    window.onload = () => {
      const { names, targets, lang, color, bg, text, size, titleSize } = getQueryParams();
      startCountdown(names, targets, lang, color, bg, text, size, titleSize);
    }
  </script>
</head>
<body class="min-h-screen flex justify-center items-start p-4">
  <div class="max-w-2xl w-full" id="countdowns"></div>
</body>
</html>
